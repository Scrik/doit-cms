Linked-связи Active Record
===================================
Уровень 1
---------

Уровень первый - разминка. Мы можем получать данные из связанных таблиц.

Пример первый. Мы имеем таблицы `products` и `catalogs` - каталоги и товары. Каждый товар может быть в каком-либо каталоге. Каталоги имеют структуру - один каталог может включать в себя несколько подкаталогов.

![связь первая](http://doit-cms.ru/storage/d026acd6ddde3af65b5b0c64da194577.png)

Вывести название каталога для товара с ID=3:

	d()->Product(3)->_catalogs->title;

Получить каталог самого дорогого товара:

	d()->Product->order_by('cost desc')->_catalogs;

Получить все товары каталога с ID=4:

	d()->prod_list = d()->Catalog(4)->_products;

Далее мы можем выводить товары как обычно:

	<foreach prod_list>
		<p>{.title}: {.cost} рублей.</p>
	</foreach>

Получить все подкаталоги каталога c ID=4:

	d()->Catalog(4)->_catalogs;

Получить все товары каталога с ID=4, которые стоят больше 100 рублей:

	d()->Catalog(4)->_products->where('cost > 100');

Уровень 2
---------

Пример тот же. Данные те же. Условия усложнены:

Получить все подкаталоги каталога с ID=4:

	d()->Catalog(4)->_catalogs;

Получить все товары всех подкаталогов каталога c ID=4:

	d()->Catalog(4)->_catalogs->_products;

Получить все товары всех каталогов, отмеченных как новые `is_new = 1`:

	d()->Catalog->where('is_new = 1')->_products;

Получить все каталоги тех товаров, которые стоят больше 100 рублей:

	d()->Product->where('cost > 100')->_catalogs;

Пример второй: мы имеем список клиентов, каждый из которых имеет указанный город из таблицы `cities`.

![связь вторая](http://doit-cms.ru/storage/8d4c4fbb2a7e36700b6feae99cd43587.png)

Получить все города, которые имеются в данном списке клиентов:

	d()->Client->search('name', $_GET['s'])->_cities;

Получить всех клиентов, которые имеются в массиве городов 

	<?php
	// http://site/clients/?cities_list[]=3&cities_list[]=34&cities_list=37&cities_list=71
	d()->City($_GET['cities_list'])->_clients;

Пример третий. Есть таблица брендов. У каждого товара есть указанный бренд (производитель).

![связь третья](http://doit-cms.ru/storage/1fc292b1de718a18c5bc0b103ad6c41a.png)

Получить список всех товаров каталога с ID=3. Над списком товаров вывести список брендов, которые присутсвуют в данном списке:

	d()->products = d()->Catalog(3)->_products;
	d()->brands = d()->products->_brands;

Уровень 3
---------

`many_to_many`, `many-to-many` to `many-to-many`.

Уровень 4
---------


Плюс. Типы прав (админ и т.д.)

Уровень 5
---------

Несколько строк

Документ в нескольких разделах одновременно. Вывести документы раздела, к которым есть доступ (группы, права).

"Пользователь может состоять в одной или нескольких группах, группа может иметь доступы разного уровня к одному или несколкьим документами, пользователь может иметь уровень разного доступа к одному или нескольким документами пользователь может быть администратором группы", показать все документы к которым имеет доступ пользователь, включая его документы и документы всех пользователей, всех групп, админом которых он является, с определенным уровнем доступа


Уровень X
---------

Друзьяшки!

Список похожих товаров.

Список аксессуаров (привязан к каталогу и товару). И обратно - получить список товаров, для которого товар - аксессуар.

Список партнёров/торговых точек/компаний в группе компаний.

И обратно - получить родительскую компанию.