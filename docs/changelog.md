История версий
==============
0.26.9
------

Параметр в валидаторе для отображения скрытого поля. Если поле пришло не пустым - валидатор дальше не пустит. Необходимо для защиты от ботов. В валидаторе пишется следующее:

	[validator.contactform#send.city]
	must_be_empty.message=Возможно, вы робот. Уйдите.

В код формы вставляется примерно следующее:
	
	
	<div style="display:none">
		<input  type="text" name="city" placeholder="Город" autocomplete="off">
	</div>

autocomplete="off" необходимо, чтобы в это поле не вбился автоматически город. Поле `city` можно изменить на любое подходящее.

**Внимание!** название поля в виде `city`, а не `data[city]` актуально только для форм с `'simple_names'=>true,`! Это обычное поле с обычными данными и обычным валидатором, просто работает наоборот.
	
*24.03.2014*

0.26.8.1
--------

{{sort_icon}} без параметров берёт опции предыдущего {{add}}. Это сделано потому, что в большинстве случаях (срого говоря, на практике - во всех) параметры этих иконок всегда одинаковы.

*23.03.2013*

0.26.8
------

Теперь администратор может сортировать столбики в таблице вывода списка элементов путём щелчка по ним.

*22.03.2014*

0.26.7
------

Поддержка записи вида

	d()->News(array(12,5,7));
	//Идентично следующему
	d()->News->where('id IN (?)', array(12,5,7));

*21.03.2014*

0.26.6.1
--------

Поддержка TRUNCATE в ActiveRecord. Вызывается так:

	d()->Konkurs->truncate(true);
	d()->Page->truncate(true);

true - обязательный параметр, его не надо настраивать или передавать как переменную. Это сделано для безопасности.

**Внимание!** Выполнение функции как переменной или вызов без обязательного параметра `true` приведёт к ошибке. Будьте внимательны и осторожны со своими данными.

*19.03.2014*

0.26.6
------

Функция `declOfNum` (определяющая множественное число) теперь имеет несколько альтернативных синтаксисов:

	//Было
	d()->declOfNum(81,array('попугай','попугая','попугаев'))
	//Теперь ещё можно так
	d()->declOfNum(1,'комментарий','комментария','комментариев');
	d()->declOfNum(2,'комментарий','комментария','комментариев');

Также теперь можно вовсе не передавать все слова - функция сама попытается определить грамматически правильную форму:

	d()->declOfNum(2,'комментарий'); //комментария
	d()->declOfNum(20,'новость'); //новостей

Это также работает для английских слов (на всякий случай):
	
	d()->declOfNum(20,'child'); //children

Также шаблонизатор поддерживает конструкцию вида `{obj.prop|func "params"}`. В итоге, теперь можно писать так:

	{news_list.count} {news_list.count|declOfNum "новость"}
	{Comment.count} {Comment.count|declOfNum "комментарий"}

Также обновлены тесты для всего этого.

*18.03.2014*

0.26.5
------

Обновлён TinyMCE 3.5.6 (2012-07-26) → 3.5.10 (2013-10-24).

*17.03.2014*

0.26.4
------

Поддержка татарского языка в датах (мультиязычность). Поддержка обработок дат вида

	d()->Date('12 января 2014');
	d()->Date('12 гыйнвар 2014');
	d()->Date('12 02 2014');


*16.03.2014*


0.26.3
------
`htmlimage` загрузчик картинок теперь поддерживает перетаскивание нескольких файлов одновременно (для `multiple=yes`).

Модуль `image` теперь полностью замещён новым загрузчиком. Для старых браузеров автоматически отображается старый вариант на flash.

Таким образом, сейчас основной элемент `image` для загрузок картинок администратором обновлён, выглядит и работает по другому. Сам механизм и принцип работы остались прежними, в первую очередь добавились удобства - скорость работы, работа на некоторых устройствах без flash (некоторые планшеты и т.д.), появилось перетаскивание файлов в браузер, вставка из буфера обмена, внешний вид.

*13.03.2014*

0.26.2.3
--------

`htmlimage` загрузчик картинок теперь поддерживает `multiple=yes`, позволяя выбрать несколько изображений одновременно.

*13.03.2014*

0.26.2.2
--------

`htmlimage` загрузчик картинок теперь может вставлять изображения перетаскиванием файла в браузер.

*12.03.2014*

0.26.2.1
--------

`htmlimage` загрузчик картинок теперь может вставлять изображения из буфера обмена (изображения, не файлы изображений) и автоматически загружать их в виде файлов.

*12.03.2014*

0.26.2
------
Поддержка автогенерируемого sitemap.xml.

В роутере необходимо прописать

	/sitemap.xml	main		show_sitemap

Файлы `sitemap.func.php` и `sitemap.ini` должны находиться в папке app (они не создадутся при обновлении). Сами правила описаны в файле `sitemap.ini`, там перечислены адреса и таблицы, которые должны быть видны в карте сайта.

0.26.1.1
--------

Исправлено поведение загрузчика в IE11.

*11.03.2014*

0.26.1
------
Новый тип файлового загрузчика для панели администратора, без использования flash. Вызывается тем же синтаксисом, но называется `htmlimage`:

	htmlimage image "Изображение" galleries 180 auto

Работает немного отзывчивее, чем на основе flash, но работает только начиная с IE9 и Opera 12. ([http://caniuse.com/xhr2](http://caniuse.com/xhr2)).

Если опыт покажет положительный результат, обычный `image` будет заменён на этот, либо в старых браузерах будет подставляться flash-версия.

*11.03.2014*

0.26
----
Поддержка пользователей для системы администрирования с правами на разные таблицы.

Для того, чтобы воспользоваться, следует раскомментировать строки в `admin.ini` (или вписать их):

	[admin.users]
	enabled=yes

И добавить ссылку на редактирование пользователей.

	[admin.leftmenu]
	admin_users "Администраторы системы"

Система предложить создать таблицу `admin_users`. Для создания нового пользователя системы администрирования необходимо указать его логин, пароль и список таблиц, в которые он имеет доступ через запятую, например, `pages, news, options`.

Все иконки администратора будут автоматически скрываться, если у администратора нет соответствующего доступа.

Доступ закрывается к таблицам, включая иконки, страницы редактирования и списка объектов, а
также на сами действия по сохранению, созданию или удалению.

Более подробно будет описано в документации.

*11.03.2014*

0.25.3
------
Поддержка нормальных дат.

Наконец появилась возможность задавать даты в админке в поле формата `date`, а не строки.

Итого, для использования в админке необходимо вписать:

	date date_at "Дата"

Если будет передана пустая строка, то дата сохранится как `NULL`, тоже самое касается класса `ActiveRecord` в целом.

**Внимание!** Если вы манипулировали в своих проектах строками вида "0000-00-00 00:00:00", то теперь вместо них будет записываться `NULL`

Обязательное условие - название поля должно оканчиваться на `_at`, например, `date_at`, `fired_at`, `posted_at`.

Функция `userdate`, преобразующая к нормальному виду, по-прежнему работает.

Появилась возможность написать

	<?php
	d()->Date(d()->this->posted_at)->to_simple(); // "24.03.2014"
	d()->Date(d()->this->posted_at)->to_mysql(); // "2014-03-24 12:00:00"

Также обновлены тесты для пагинации и для проверки дат.

*10.03.2014*

0.25.2
------
Класс `Upload` для простой загрузки файлов  изображений.

Для самого простого использования:
	
	$filename = d()->Upload->save();

В переменной `$filename` будет находиться адрес к файлу (в случае картинки - готовой к созданию превью). По-умолчанию пустит только картинки и распространённые файлы.

Параметр `upload` для формы, указывающий `enctype` для загрузки файлов.

*09.03.2014*

0.25.1.1
--------
Вывод текущей версии в админке (только для developer, подвал и страница обновления).

*08.03.2014*

0.25.1
------
Оптимизирован код ActiveRecord, убраны некоторые лишние проверки, которые никогда не будут вызваны.

Заведена история версий, которая будет использоваться для определения текущей версии системы (для обновления).

*08.03.2014*
